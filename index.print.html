<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article" data-r-output-format="print">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.148.1">
    <meta name="generator" content="Relearn 8.0.0">
    <meta name="description" content="Lorem Ipsum. Test GitHub">
    <meta name="author" content="Russell Feldhausen">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://textbooks.cs.ksu.edu/extras/images/hero.png">
    <meta name="twitter:title" content="K-State CS Textbook Extras">
    <meta name="twitter:description" content="Lorem Ipsum. Test GitHub">
    <meta property="og:url" content="https://textbooks.cs.ksu.edu/extras/index.html">
    <meta property="og:site_name" content="K-State CS Textbook Extras">
    <meta property="og:title" content="K-State CS Textbook Extras">
    <meta property="og:description" content="Lorem Ipsum. Test GitHub">
    <meta property="og:locale" content="en_us">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://textbooks.cs.ksu.edu/extras/images/hero.png">
    <meta itemprop="name" content="K-State CS Textbook Extras">
    <meta itemprop="description" content="Lorem Ipsum. Test GitHub">
    <meta itemprop="dateModified" content="2022-12-07T13:12:49-06:00">
    <meta itemprop="wordCount" content="4">
    <meta itemprop="image" content="https://textbooks.cs.ksu.edu/extras/images/hero.png">
    <title>K-State CS Textbook Extras</title>
    <link href="https://textbooks.cs.ksu.edu/extras/index.html" rel="canonical" type="text/html" title="K-State CS Textbook Extras">
    <link href="/extras/index.xml" rel="alternate" type="application/rss+xml" title="K-State CS Textbook Extras">
    <link href="/extras/index.lti.js" rel="alternate" type="text/javascript" title="K-State CS Textbook Extras">
    <link href="/extras/css/auto-complete/auto-complete.min.css?1757555851" rel="stylesheet">
    <script src="/extras/js/auto-complete/auto-complete.min.js?1757555851" defer></script>
    <script src="/extras/js/search-lunr.min.js?1757555851" defer></script>
    <script src="/extras/js/search.min.js?1757555851" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.index_js_url="/extras/searchindex.en.js?1757555851";
    </script>
    <script src="/extras/js/lunr/lunr.min.js?1757555851" defer></script>
    <script src="/extras/js/lunr/lunr.stemmer.support.min.js?1757555851" defer></script>
    <script src="/extras/js/lunr/lunr.multi.min.js?1757555851" defer></script>
    <script src="/extras/js/lunr/lunr.en.min.js?1757555851" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.contentLangs=['en'];
    </script>
    <link href="/extras/fonts/fontawesome/css/fontawesome-all.min.css?1757555851" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/extras/fonts/fontawesome/css/fontawesome-all.min.css?1757555851" rel="stylesheet"></noscript>
    <link href="/extras/css/perfect-scrollbar/perfect-scrollbar.min.css?1757555851" rel="stylesheet">
    <link href="/extras/css/theme.min.css?1757555851" rel="stylesheet">
    <link href="/extras/css/format-print.min.css?1757555851" rel="stylesheet" id="R-format-style">
    <script>
      window.relearn = window.relearn || {};
      // configuration
      window.relearn.min = `.min`;
      window.relearn.path='\/index.html';
      window.relearn.relBasePath='.';
      window.relearn.relBaseUri='..';
      window.relearn.absBaseUri='https:\/\/textbooks.cs.ksu.edu\/extras';
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      window.relearn.disableInlineCopyToClipboard=true;
      window.relearn.enableBlockCodeWrap=false;
      // legal
      window.relearn.getItem = (s,n) => {return s.getItem(n)};
      window.relearn.setItem = (s,n,v) => {return s.setItem(n,v)};
      window.relearn.removeItem = (s,n) => {return s.removeItem(n)};
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
      // variant stuff
      window.relearn.themevariants = [ 'auto', 'light-theme', 'dark-theme' ];
      window.relearn.customvariantname = "my-custom-variant";
      // [x] russfeld
      window.relearn.writeVariant=true;
      window.relearn.changeVariant = function(variant) {
        var oldVariant = document.documentElement.dataset.rThemeVariant;
        window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        document.documentElement.dataset.rThemeVariant = variant;
        if (oldVariant != variant) {
          document.dispatchEvent( new CustomEvent('themeVariantLoaded', { detail: { variant, oldVariant } }) );
          window.relearn.markVariant();
        }
      }
      window.relearn.markVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant");
        document.querySelectorAll(".R-variantswitcher select").forEach((select) => {select.value = variant;});
      }
      window.relearn.initVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant") ?? "";
        if( variant == window.relearn.customvariantname ){
        }else if( !variant || !window.relearn.themevariants.includes(variant) ){
          variant = window.relearn.themevariants[0];
          
          if (window.relearn.writeVariant) {
            window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
          }
        }
        document.documentElement.dataset.rThemeVariant = variant;
      }
      window.relearn.initVariant();
      window.relearn.markVariant();
    </script>
    <link href="/extras/css/custom.css?1757555851" rel="stylesheet">
  </head>
  <body class="mobile-support print" data-url="/extras/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
            <div class="topbar-button topbar-button-toc" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="Table of Contents (CTRL&#43;ALT&#43;t)"><i class="fa-fw fas fa-list-alt"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper"> 
                </div>
              </div>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class="a11y-only"><span itemprop="name">K-State CS Textbook Extras</span><meta itemprop="position" content="1"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-edit" data-content-empty="disable" data-width-s="area-more" data-width-m="show" data-width-l="show"><a class="topbar-control" href="https://github.com/ksu-cs-textbooks/extras/edit/master/content/_index.md" rel="external" target="_blank" title="Edit (CTRL+ALT+w)"><i class="fa-fw fas fa-pen"></i></a>
            </div>
            <div class="topbar-button topbar-button-print" data-content-empty="disable" data-width-s="area-more" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/extras/index.print.html" title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a>
            </div>
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><span class="topbar-control"><i class="fa-fw fas fa-chevron-left"></i></span>
            </div>
            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/extras/01-introduction/index.html" title="Introduction (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>
            <div class="topbar-button topbar-button-more" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="More"><i class="fa-fw fas fa-ellipsis-v"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
                  <div class="topbar-area topbar-area-more" data-area="more">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable page" tabindex="-1">
        <div class="flex-block-wrapper">
          <section>
            <h1 class="a11y-only">Subsections of K-State CS Textbook Extras</h1>
<article class="default">
  <header class="headline">
  </header>

<h1 id="introduction">Introduction</h1>

<p>Lorem Ipsum.</p>

  <footer class="footline">
  </footer>
</article>
          <section>
            <h1 class="a11y-only">Subsections of Introduction</h1>
<article class="default">
  <header class="headline">
  </header>

<h1 id="welcome">Welcome</h1>

<p>Lorem Ipsum.</p>

  <footer class="footline">
  </footer>
</article>
          </section>
<article class="default">
  <header class="headline">
  </header>

<h1 id="full-stack-web-application">Full Stack Web Application</h1>

<p>A full stack web application from scratch!</p>

  <footer class="footline">
  </footer>
</article>
          <section>
            <h1 class="a11y-only">Subsections of Full Stack Web Application</h1>
<article class="default">
  <header class="headline">
  </header>

<h1 id="introduction">Introduction</h1>

<p>This is a brief guide to building a framework for a full-stack web application from scratch.</p>
<h2 id="features">Features</h2>
<ul>
<li>Express.js Backend</li>
<li>React Frontend
<ul>
<li>Can easily substitute Vue or other frontends</li>
</ul>
</li>
<li>Postgres Database
<ul>
<li>Can easily substitue MySQL or other databases</li>
</ul>
</li>
<li>Full Docker Setup for Development
<ul>
<li>You don&rsquo;t have to install Node or a database locally - it all runs in Docker!</li>
</ul>
</li>
<li>Docker Deployment</li>
<li>GitHub Actions</li>
</ul>
<p><strong>What this is:</strong> this guide will give you the steps to build the framework, including links to associated resources and tutorials. Basically, it will show you <em>what</em> to do.</p>
<p><strong>What this is not:</strong> this guide is not an exhaustive explanation of <em>why</em> or <em>how</em> to do these steps. It also doesn&rsquo;t cover how to build a web application once you have this framework set up. So, you may have to do some extra reading to really understand what is going on and match this framework to your needs.</p>
<h2 id="conventions">Conventions</h2>
<p>Some brief conventions in this guide:</p>
<ul>
<li>Code blocks will include a comment at the top giving the filename where the code is placed or the terminal where the commands should be executed.</li>
<li>Be careful copy/pasting code - you may have to modify code or commands to match your environment!</li>
</ul>
<h2 id="faq">FAQ</h2>
<ul>
<li><strong>Can I download this framework somewhere?</strong> Yes, it is on <a href="https://github.com/russfeld/fullstack" rel="external" target="_blank">GitHub</a>. However, the value in this framework is really going through the work of building it yourself so you understand what it contains and how it works. Then, once you&rsquo;ve built it yourself once, you can reuse your own version and tweak it as needed.</li>
</ul>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="setup">Setup</h1>

<h2 id="prerequisites">Prerequisites</h2>
<p>The basic environment required for this setup:</p>
<ul>
<li>A Linux/Unix system
<ul>
<li>Ubuntu/Debian is preferred. Mac OS X (Darwin) should also work.</li>
</ul>
</li>
<li>Docker Desktop</li>
<li>Visual Studio Code</li>
<li>Git and GitHub</li>
</ul>
<p>This guide will use the following environment:</p>
<ul>
<li>Windows 10 Host OS (should work on Windows 11 as well)</li>
<li><a href="https://learn.microsoft.com/en-us/windows/wsl/install" rel="external" target="_blank">Windows Subsystem for Linux WSL 2</a></li>
<li><a href="https://ubuntu.com/tutorials/install-ubuntu-on-wsl2-on-windows-11-with-gui-support#1-overview" rel="external" target="_blank">Ubuntu LTS on WSL 2</a>
<ul>
<li>You do not need to install a GUI package as described in this guide</li>
</ul>
</li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-install-git-on-ubuntu-22-04" rel="external" target="_blank">Git installed on Ubuntu in WSL 2</a>
<ul>
<li>You may also wish to either set up <a href="https://learn.microsoft.com/en-us/windows/wsl/tutorials/wsl-git" rel="external" target="_blank">Git Credential Manager</a> to share Git credentials with Windows or set up <a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/about-ssh" rel="external" target="_blank">SSH Keys</a> to communicate with GitHub</li>
</ul>
</li>
<li><a href="https://docs.docker.com/desktop/windows/wsl/" rel="external" target="_blank">Docker Desktop with WSL 2 Backend</a></li>
<li><a href="https://learn.microsoft.com/en-us/windows/wsl/tutorials/wsl-vscode" rel="external" target="_blank">Visual Studio Code and WSL Extension</a>
<ul>
<li>You may also wish to install the <a href="https://learn.microsoft.com/en-us/windows/wsl/tutorials/wsl-containers" rel="external" target="_blank">Dev Containers</a> extension. This guide will not use it, but that is an alternative way to develop within a container.</li>
</ul>
</li>
</ul>
<h2 id="optional">Optional</h2>
<p>To match the environment seen in the screenshots/videos, you can install these optional items:</p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/windows/terminal/install" rel="external" target="_blank">Windows Terminal</a></li>
<li><a href="https://github.com/tonsky/FiraCode" rel="external" target="_blank">FiraCode</a> font in VSCode</li>
<li>Zsh terminal and <a href="https://github.com/ohmyzsh/ohmyzsh" rel="external" target="_blank">Oh My Zsh</a> in Ubuntu</li>
<li><a href="https://github.com/romkatv/powerlevel10k" rel="external" target="_blank">Powerlevel10k</a> Zsh theme
<ul>
<li><a href="https://github.com/romkatv/powerlevel10k#meslo-nerd-font-patched-for-powerlevel10k" rel="external" target="_blank">Meslo Nerd Font</a> is recommended</li>
</ul>
</li>
</ul>
<h2 id="other-systems">Other Systems</h2>
<p>This guide should generally work for developing on both Ubuntu/Debian Linux systems as well as Mac OS X systems. Some modifications will need to be made, but in general you want to have Visual Studio Code, Docker Desktop, and Git installed.</p>
<p>Likewise, deployment will mostly use GitHub actions but I will also include information for using GitLab runners.</p>
<h2 id="helpful-resources">Helpful Resources</h2>
<ul>
<li><a href="https://learn.microsoft.com/en-us/windows/wsl/setup/environment" rel="external" target="_blank">Set up a WSL development environment</a></li>
<li><a href="https://learn.microsoft.com/en-us/windows/wsl/filesystems" rel="external" target="_blank">WSL Filesystems</a></li>
</ul>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="initialize">Initialize</h1>

<h2 id="create-repository">Create Repository</h2>
<p>Start by creating a new GitHub repository. We&rsquo;ll let it initialize the repository using a <code>README</code> file, and also select the <code>.gitignore</code> file for a Node project.</p>
<p><a href="#R-image-db48cbca36d9a22b4e05c5076dadcea8" class="lightbox-link"><img alt="Create Repository" class="border lazy lightbox figure-image" loading="lazy" src="/extras/images/repo.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-db48cbca36d9a22b4e05c5076dadcea8"><img alt="Create Repository" class="border lazy lightbox lightbox-image" loading="lazy" src="/extras/images/repo.png"></a></p>
<p>If you&rsquo;ve already created the repository, you can get the <code>.gitignore</code> file for Node projects from GitHub&rsquo;s <a href="https://github.com/github/gitignore/blob/main/Node.gitignore" rel="external" target="_blank">gitignore repository</a></p>
<h2 id="check-out-repository">Check out Repository</h2>
<p>Next, check out the repository:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Terminal</span>
</span></span><span style="display:flex;"><span>git clone git@github.com:russfeld/fullstack.git
</span></span><span style="display:flex;"><span>cd fullstack
</span></span><span style="display:flex;"><span>code .</span></span></code></pre></div>

<details open class=" box cstyle notices tip">
  <summary class="box-label" tabindex="-1">
    <i class="fa-fw fas fa-lightbulb"></i> 
    Tip
  </summary>
  <div class="box-content">
<p>Change the repository URL to match your repository!</p>
  </div>
</details>
<p>This should open the repository in Visual Studio Code.</p>
<h2 id="create-the-file-structure">Create the File Structure</h2>
<p>Create the following folders within your project:</p>
<ul>
<li><code>client</code></li>
<li><code>server</code></li>
</ul>
<p>These folders will store the frontend and backend applications, respectively.</p>
<p>At this point, you should have the following structure:</p>
<p><a href="#R-image-28b03eb670c9b98d3be9483f2c97b737" class="lightbox-link"><img alt="Initial Structure" class="border lazy lightbox figure-image" loading="lazy" src="/extras/images/initial.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-28b03eb670c9b98d3be9483f2c97b737"><img alt="Initial Structure" class="border lazy lightbox lightbox-image" loading="lazy" src="/extras/images/initial.png"></a></p>

<details open class=" box cstyle notices note">
  <summary class="box-label" tabindex="-1">
    <i class="fa-fw fas fa-exclamation-circle"></i> 
    Note
  </summary>
  <div class="box-content">
<p>If you aren&rsquo;t using GitHub, you can simply create the directory structure shown above manually or modify your existing project to match.</p>
  </div>
</details>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="docker">Docker</h1>


<details open class=" box cstyle notices note">
  <summary class="box-label" tabindex="-1">
    <i class="fa-fw fas fa-exclamation-circle"></i> 
    Note
  </summary>
  <div class="box-content">
<p>If you have already created projects locally, skip down to the <a href="/extras/02-full-stack/04-docker/index.html#01">Remove Node Modules</a> section below. You can Dockerize existing projects as well!</p>
  </div>
</details>
<h2 id="get-effective-ids">Get Effective IDs</h2>
<p>First, we need to make a note of our effective user ID and group ID in the terminal:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Terminal</span>
</span></span><span style="display:flex;"><span>id</span></span></code></pre></div>
<p>You should get output that begins with something similar to this:</p>
<div class="highlight" dir="auto"><pre tabindex="0"><code>uid=1000(youboon2) gid=1000(youboon2)</code></pre></div>
<p>Remember those two numbers for later!</p>
<h2 id="create-projects">Create Projects</h2>
<p>To create the projects themselves, we&rsquo;re going to use a one-off Docker command to run a container.</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Terminal</span>
</span></span><span style="display:flex;"><span>docker run --rm -it --user<span style="color:#f92672">=</span>1000:1000 -v <span style="color:#e6db74">`</span>pwd<span style="color:#e6db74">`</span>/:/app node:18 bash</span></span></code></pre></div>

<details open class=" box cstyle notices tip">
  <summary class="box-label" tabindex="-1">
    <i class="fa-fw fas fa-lightbulb"></i> 
    Tip
  </summary>
  <div class="box-content">
<p>Modify the command above to match your IDs found earlier. See below for details. Make sure you run this command in the root directory of your project!</p>
  </div>
</details>
<p>In this command:</p>
<ul>
<li><code>docker run</code> will start a container to run a command. The container is removed when the command is finished.</li>
<li><code>--rm</code> will remove the container when it is finished</li>
<li><code>-it</code> will provide an interactive terminal</li>
<li><code>--user=1000:1000</code> will set the user and group IDs to 1000, respectively - match these to the output you received above.</li>
<li><code>-v `pwd`/:/app&lt;/code&gt;</code> will create a volume mount between the current directory and the <code>/app</code> directory in the container.
<ul>
<li>Backticks around a command in the terminal will use the result of that command in the outer command. You could instead enter the full path to the current directory as part of the command, as in <code>-v /home/user/projects/fullstack:/app/code</code>.</li>
<li>See <a href="https://docs.docker.com/storage/volumes/" rel="external" target="_blank">Docker Volumes</a> for more details.</li>
</ul>
</li>
<li><code>node:18</code> is the name of the Docker image to run.
<ul>
<li>Refer to <a href="https://hub.docker.com/_/node/" rel="external" target="_blank">Node</a> on DockerHub for other image versions. At the time of writing, Node 18 is the current LTS version.</li>
</ul>
</li>
<li><code>bash</code> will load the Bash terminal inside of the container</li>
</ul>
<p>Refer to the <a href="https://docs.docker.com/engine/reference/commandline/run/" rel="external" target="_blank">Docker run</a> documentation for more details.</p>
<p>Once we have run that command, we should get a terminal inside of the container:</p>
<p><a href="#R-image-7474b91602f85129c307d810c8291a55" class="lightbox-link"><img alt="Docker Terminal" class="border lazy lightbox figure-image" loading="lazy" src="/extras/images/terminal.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-7474b91602f85129c307d810c8291a55"><img alt="Docker Terminal" class="border lazy lightbox lightbox-image" loading="lazy" src="/extras/images/terminal.png"></a></p>
<p>To create the projects, we are going to use <a href="https://expressjs.com/en/starter/generator.html" rel="external" target="_blank">Express Application Generator</a> and <a href="https://create-react-app.dev/" rel="external" target="_blank">Create React App</a>. You can refer to those pages for additional options that you can use when creating these projects.</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Docker Container Terminal</span>
</span></span><span style="display:flex;"><span>npx express-generator -v ejs /app/server
</span></span><span style="display:flex;"><span>npx create-react-app /app/client</span></span></code></pre></div>

<details open class=" box cstyle notices note">
  <summary class="box-label" tabindex="-1">
    <i class="fa-fw fas fa-exclamation-circle"></i> 
    Note
  </summary>
  <div class="box-content">
<p>This guide uses React, but you could easily use Vue or another frontend framework here. Just make sure it is placed in the <code>/app/client</code> directory inside of the container.</p>
  </div>
</details>
<p>Once we are done, we can exit the container:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Docker Container Terminal</span>
</span></span><span style="display:flex;"><span>exit</span></span></code></pre></div>
<p>This will stop the container and remove it.</p>
<h2 id="01">Remove Node Modules</h2>
<p>Finally, we want to remove the <code>node_modules</code> folders from both the <code>client</code> and <code>server</code> folders. These are created when the project is first initialized, but we don&rsquo;t want them outside of our actual containers. So, <strong>DELETE</strong> both <code>node_modules</code> folders!</p>
<h2 id="configure-docker">Configure Docker</h2>
<p>Now let&rsquo;s configure Docker to allow us to load both projects in separate Docker containers.</p>
<p>Create a <code>docker-compose.yml</code> file in the root directory of the project with the following content:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#75715e"># docker-compose.yml</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">services</span>:
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># server</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">project-server</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">build</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># location of Dockerfile</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">context</span>: <span style="color:#ae81ff">./server</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">project-server</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># set the user ID to match our user</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">user</span>: <span style="color:#e6db74">&#34;1000&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">networks</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">project-network</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># allow external connections (remove this in production)</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># mount code into container</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./server:/app/server</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># maintain existing node_modules in container</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">/app/server/node_modules</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># client</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">project-client</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">build</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># location of Dockerfile</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">context</span>: <span style="color:#ae81ff">./client</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">project-client</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># set the user ID to match our user</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">user</span>: <span style="color:#e6db74">&#34;1000&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">depends_on</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># requires server to start</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">project-server</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">networks</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">project-network</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># allow external connections</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># mount code into container</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./client:/app/client</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># maintain existing node_modules in container</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">/app/client/node_modules</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">networks</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># internal Docker network for project</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">project-network</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">project-network</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">internal</span>: <span style="color:#66d9ef">true</span></span></span></code></pre></div>
<p>Refer to <a href="https://docs.docker.com/compose/compose-file/compose-file-v3/" rel="external" target="_blank">Docker Compose File Reference</a> for what this does.</p>

<details open class=" box cstyle notices tip">
  <summary class="box-label" tabindex="-1">
    <i class="fa-fw fas fa-lightbulb"></i> 
    Tip
  </summary>
  <div class="box-content">
<p>Update <code>user: &quot;1000&quot;</code> in each of these files to match the user ID found earlier.</p>
  </div>
</details>
<p>We&rsquo;ll also need to add a Dockerfile to each project:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dockerfile" data-lang="dockerfile"><span style="display:flex;"><span><span style="color:#75715e"># client/Dockerfile</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># For running in development mode only</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> node:18</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">USER</span><span style="color:#e6db74"> 1000</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> /app/client</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> --chown<span style="color:#f92672">=</span>1000:1000 package*.json ./<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> npm install<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">EXPOSE</span><span style="color:#e6db74"> 3000</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">CMD</span> [<span style="color:#e6db74">&#34;npm&#34;</span>, <span style="color:#e6db74">&#34;start&#34;</span>]</span></span></code></pre></div>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dockerfile" data-lang="dockerfile"><span style="display:flex;"><span><span style="color:#75715e"># server/Dockerfile</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># For running in development mode only</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> node:18</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">USER</span><span style="color:#e6db74"> 1000</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> /app/server</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> --chown<span style="color:#f92672">=</span>1000:1000 package*.json ./<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> npm install<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">EXPOSE</span><span style="color:#e6db74"> 3000</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">CMD</span> [<span style="color:#e6db74">&#34;npm&#34;</span>, <span style="color:#e6db74">&#34;run&#34;</span>, <span style="color:#e6db74">&#34;dev&#34;</span>]</span></span></code></pre></div>
<p>Refer to <a href="https://docs.docker.com/engine/reference/builder/" rel="external" target="_blank">Dockerfile Reference</a> for the structure of these files.</p>

<details open class=" box cstyle notices tip">
  <summary class="box-label" tabindex="-1">
    <i class="fa-fw fas fa-lightbulb"></i> 
    Tip
  </summary>
  <div class="box-content">
<p>Update <code>user: &quot;1000&quot;</code> and <code>--chown=1000:1000</code> in each of these files to match the user ID and group ID found earlier.</p>
  </div>
</details>
<p>Finally, we can start and run the Docker containers using Docker Compose:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Terminal</span>
</span></span><span style="display:flex;"><span>docker compose up -d</span></span></code></pre></div>
<p>Refer to the <a href="https://docs.docker.com/compose/reference/" rel="external" target="_blank">Docker Compose CLI Reference</a> for how to use Docker Compose commands.</p>
<p>It will take a bit to build and configure both containers, but eventually the command should finish. This will be faster in the future. You can confirm they are running using the <code>docker ps</code> command.</p>
<p><a href="#R-image-bf8753e4f67c1a96f97192dd4886c7be" class="lightbox-link"><img alt="Docker PS" class="border lazy lightbox figure-image" loading="lazy" src="/extras/images/docker_ps.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-bf8753e4f67c1a96f97192dd4886c7be"><img alt="Docker PS" class="border lazy lightbox lightbox-image" loading="lazy" src="/extras/images/docker_ps.png"></a></p>
<p>To stop the containers when you are done, use</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Terminal</span>
</span></span><span style="display:flex;"><span>docker compose down</span></span></code></pre></div>
<h2 id="commit">Commit</h2>
<p>This is a great place to stop and commit your work to GitHub.</p>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="working-with-docker">Working with Docker</h1>

<p>Now that the project is running in Docker, let&rsquo;s review some helpful commands we can use to interact with the Docker containers.</p>
<h2 id="docker-status">Docker Status</h2>
<p>Query running container status</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Terminal</span>
</span></span><span style="display:flex;"><span>docker ps</span></span></code></pre></div>
<p>Sample output:</p>
<div class="highlight" dir="auto"><pre tabindex="0"><code>CONTAINER ID   IMAGE                      COMMAND                  CREATED         STATUS         PORTS      NAMES
119d2cc1ae20   fullstack-project-client   &#34;docker-entrypoint.sâ€¦&#34;   2 minutes ago   Up 2 minutes   3000/tcp   project-client
b5c0853fa8b2   fullstack-project-server   &#34;docker-entrypoint.sâ€¦&#34;   2 minutes ago   Up 2 minutes              project-server</code></pre></div>
<h2 id="software-output">Software Output</h2>
<p>You can view the output of programs running in a container using this command:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Terminal</span>
</span></span><span style="display:flex;"><span>docker logs project-client</span></span></code></pre></div>
<p>Replace <code>project-client</code> with the name of the container to query.</p>
<p>If you want to monitor the logs for new output, add the <code>-f</code> flag:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Terminal</span>
</span></span><span style="display:flex;"><span>docker logs -f project-client</span></span></code></pre></div>
<p>When following the logs, use <kbd>CTRL</kbd> + <kbd>C</kbd> to exit.</p>
<h2 id="terminal">Terminal</h2>
<p>To get an interactive terminal inside of the container, use this command:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Terminal</span>
</span></span><span style="display:flex;"><span>docker exec -it project-client bash</span></span></code></pre></div>
<p>Replace <code>project-client</code> with the name of the container to run the command in.</p>
<p>The command <code>bash</code> will get you an interactive terminal running Bash. You can replace <code>bash</code> with another command to run that command inside of the container itself. This allows you to run comands inside of the contaniner while it is running. However, your app will also be running, so you will be limited in what you can do.</p>
<h2 id="run-commands">Run Commands</h2>
<p>Alternatively, you can run some commands inside of a container using Docker compose:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#Terminal</span>
</span></span><span style="display:flex;"><span>docker compose run --rm project-client npm run test</span></span></code></pre></div>
<p>This will create a new temporary container to run the command, so be aware that there may be some side effects of doing so.</p>
<h2 id="cleanup">Cleanup</h2>
<p>Finally, Docker provides a handy command to cleanup any unused Docker resources on your system to conserve space:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Terminal</span>
</span></span><span style="display:flex;"><span>docker system prune</span></span></code></pre></div>
<p>This removes all unused containers, images, networks, and more. However, it will not remove any data volumes by default, but you can add the <code>--volumes</code> option to do just that.</p>
<h2 id="reference">Reference</h2>
<p><a href="https://docs.docker.com/engine/reference/commandline/cli/" rel="external" target="_blank">Docker Command Line Reference</a></p>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="nodemon">Nodemon</h1>

<p>At this point we probably want to install the <a href="https://www.npmjs.com/package/nodemon" rel="external" target="_blank">Nodemon</a> tool in our backend.</p>
<h2 id="install-nodemon">Install Nodemon</h2>
<p>First, we&rsquo;ll get a terminal inside of the container</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Terminal</span>
</span></span><span style="display:flex;"><span>docker exec -it project-server bash</span></span></code></pre></div>
<p>Then we can use the usual process to install Nodemon using <code>npm</code>. Make sure this is done inside of the <code>/app/server</code> directory:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Docker project-server Terminal</span>
</span></span><span style="display:flex;"><span>npm install nodemon</span></span></code></pre></div>
<p>Once Nodemon is installed, we can close the terminal connected to the container using the <code>exit</code> command.</p>

<details open class=" box cstyle notices tip">
  <summary class="box-label" tabindex="-1">
    <i class="fa-fw fas fa-lightbulb"></i> 
    Tip
  </summary>
  <div class="box-content">
<p>This same basic process can be used to install any library using <code>npm</code> inside of the container.</p>
  </div>
</details>
<h2 id="update-dockerfile">Update Dockerfile</h2>
<p>To use Nodemon inside of our container, we need to update the <code>scripts</code> section of the <code>package.json</code> file for the server:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">/*</span> <span style="color:#960050;background-color:#1e0010">server/package.json</span> <span style="color:#960050;background-color:#1e0010">*/</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">/*</span> <span style="color:#960050;background-color:#1e0010">other</span> <span style="color:#960050;background-color:#1e0010">contents</span> <span style="color:#960050;background-color:#1e0010">*/</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;scripts&#34;</span>: {
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#f92672">&#34;dev&#34;</span>: <span style="color:#e6db74">&#34;nodemon ./bin/www&#34;</span>,
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#f92672">&#34;start&#34;</span>: <span style="color:#e6db74">&#34;NODE_ENV=production node ./bin/www&#34;</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">/*</span> <span style="color:#960050;background-color:#1e0010">other</span> <span style="color:#960050;background-color:#1e0010">contents</span> <span style="color:#960050;background-color:#1e0010">*/</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>This adds a new <code>dev</code> command that uses Nodemon to run the server in development mode, and also changes the <code>start</code> command to run the server in production mode.</p>
<p>We also need to update the <code>CMD</code> entry in the server&rsquo;s Dockerfile to use the new <code>dev</code> command:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-dockerfile" data-lang="dockerfile"><span style="display:flex;"><span><span style="color:#75715e"># server/Dockerfile</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># For running in development mode only</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> node:18</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> /app/server</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> package*.json ./<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> npm install<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">EXPOSE</span><span style="color:#e6db74"> 3000</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">CMD</span> [<span style="color:#e6db74">&#34;npm&#34;</span>, <span style="color:#e6db74">&#34;run&#34;</span>, <span style="color:#e6db74">&#34;dev&#34;</span>]</span></span></code></pre></div>
<p>With those changes, we need to rebuild and restart our containers:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Terminal</span>
</span></span><span style="display:flex;"><span>docker compose up -d --build</span></span></code></pre></div>
<p>The <code>--build</code> will build any changed containers.</p>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="database">Database</h1>

<p>Now let&rsquo;s add a database to our project.</p>
<h2 id="postgres-container">Postgres Container</h2>
<p>First, we can add an entry to our Docker Compose file to create a Postgres database, and also an entry for the volume to store the data:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#75715e"># docker-compose.yml</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">services</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>  <span style="color:#75715e"># database</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>  <span style="color:#f92672">project-db</span>:
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#75715e"># Use an existing image from DockerHub</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">postgres:15</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">project-db</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#75715e"># Automatically restart the container as needed</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#f92672">restart</span>: <span style="color:#ae81ff">unless-stopped</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#f92672">networks</span>:
</span></span><span style="display:flex; background-color:#3c3d38"><span>      - <span style="color:#ae81ff">project-network</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex; background-color:#3c3d38"><span>      <span style="color:#75715e"># Persist database data in a Docker volume</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>      - <span style="color:#ae81ff">project_db_data:/var/lib/postgresql/data:rw</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex; background-color:#3c3d38"><span>      <span style="color:#75715e"># Configure environment using .env file</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>      <span style="color:#f92672">POSTGRES_USER</span>:
</span></span><span style="display:flex; background-color:#3c3d38"><span>      <span style="color:#f92672">POSTGRES_PASSWORD</span>:
</span></span><span style="display:flex; background-color:#3c3d38"><span>      <span style="color:#f92672">POSTGRES_DB</span>:
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#f92672">healthcheck</span>:
</span></span><span style="display:flex; background-color:#3c3d38"><span>      <span style="color:#75715e"># check if database is running and healthy</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>      <span style="color:#f92672">test</span>: [<span style="color:#e6db74">&#34;CMD-SHELL&#34;</span>, <span style="color:#e6db74">&#34;pg_isready -d $${POSTGRES_DB} -U $${POSTGRES_USER}&#34;</span>]
</span></span><span style="display:flex; background-color:#3c3d38"><span>      <span style="color:#f92672">interval</span>: <span style="color:#ae81ff">30s</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>      <span style="color:#f92672">timeout</span>: <span style="color:#ae81ff">5s</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>      <span style="color:#f92672">retries</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>      <span style="color:#f92672">start_period</span>: <span style="color:#ae81ff">10s</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># server</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">project-server</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">build</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># location of Dockerfile</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">context</span>: <span style="color:#ae81ff">./server</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">project-server</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># set the user ID to match our user</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">user</span>: <span style="color:#e6db74">&#34;1000&#34;</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#f92672">depends_on</span>:
</span></span><span style="display:flex; background-color:#3c3d38"><span>      <span style="color:#75715e"># requires database to start</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>      - <span style="color:#ae81ff">project-db</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">networks</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">project-network</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># allow external connections (remove this in production)</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># mount code into container</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./server:/app/server</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># maintain existing node_modules in container</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">/app/server/node_modules</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># client</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">project-client</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">build</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># location of Dockerfile</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">context</span>: <span style="color:#ae81ff">./client</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">project-client</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># set the user ID to match our user</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">user</span>: <span style="color:#e6db74">&#34;1000&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">depends_on</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># requires server to start</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">project-server</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">networks</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">project-network</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># allow external connections</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># mount code into container</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./client:/app/client</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># maintain existing node_modules in container</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">/app/client/node_modules</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex; background-color:#3c3d38"><span>  <span style="color:#f92672">project_db_data</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">networks</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># internal Docker network for project</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">project-network</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">project-network</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">internal</span>: <span style="color:#66d9ef">true</span></span></span></code></pre></div>
<p>Refer to the <a href="https://hub.docker.com/_/postgres" rel="external" target="_blank">Postgres Docker Image</a> documentation for more details.</p>
<h2 id="environment-file">Environment File</h2>
<p>For this project, we are going to use a single global environment file that is shared across all containers. For this, create a file named <code>.env</code> in the root of the project and add the following contents:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># .env</span>
</span></span><span style="display:flex;"><span>POSTGRES_HOST<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;project-db&#34;</span>
</span></span><span style="display:flex;"><span>POSTGRES_PORT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;5432&#34;</span>
</span></span><span style="display:flex;"><span>POSTGRES_USER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;projectuser&#34;</span>
</span></span><span style="display:flex;"><span>POSTGRES_PASSWORD<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;projectpass&#34;</span>
</span></span><span style="display:flex;"><span>POSTGRES_DB<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;projectdb&#34;</span></span></span></code></pre></div>

<details open class=" box cstyle notices tip">
  <summary class="box-label" tabindex="-1">
    <i class="fa-fw fas fa-lightbulb"></i> 
    Tip
  </summary>
  <div class="box-content">
<p>Customize the user, password, and database variables as desired. The host should match the name of the database container, and the port should be the default port for the chosen database engine.</p>
  </div>
</details>
<p>You should also create a file named <code>.env.example</code> that has the same contents.</p>

<details open class=" box cstyle notices warning">
  <summary class="box-label" tabindex="-1">
    <i class="fa-fw fas fa-exclamation-triangle"></i> 
    Warning
  </summary>
  <div class="box-content">
<p>You should never commit the <code>.env</code> file to GitHub, since it contains all of the secret information for your project. Instead, it is recommended to create a sample file such as <code>.env.example</code> that contains the same variables but with default values, and also some explanation of what each variable does.</p>
  </div>
</details>
<p>In the Docker Compose file above, we defined several variables in the <code>project-db</code> service that match variables in the <code>.env</code> file:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># Configure environment using .env file</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">POSTGRES_USER</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">POSTGRES_PASSWORD</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">POSTGRES_DB:</span></span></span></code></pre></div>
<p>By including blank variables here, the values from the <code>.env</code> file for those variables will be shared with the container. Other variables will not be shared.</p>
<h2 id="start-container">Start Container</h2>
<p>Once we are ready, we can use Docker Compose to update our running containers and start the database container:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Terminal</span>
</span></span><span style="display:flex;"><span>docker compose up -d</span></span></code></pre></div>
<p>You can confirm that the database is up and running using <code>docker ps</code> or checking the logs using <code>docker logs project-db</code>.</p>
<h2 id="commit">Commit</h2>
<p>This is a great place to stop and commit your work to GitHub.</p>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="knex">Knex</h1>

<p>We&rsquo;re going to use the <a href="https://knexjs.org/" rel="external" target="_blank">Knex</a> library to connect to our database from the server. We&rsquo;ll also use it to handle database migrations and seeding.</p>
<h2 id="install-knex">Install Knex</h2>
<p>We can install Knex using <code>npm</code> inside the server container:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Terminal</span>
</span></span><span style="display:flex;"><span>docker exec -it project-server bash</span></span></code></pre></div>
<p>Then we can use <code>npm</code> to install the <code>knex</code> library, along with the <code>pg</code> library for connecting to Postgres databases. This should be done in the <code>/app/server</code> directory inside the container:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Docker project-server Terminal</span>
</span></span><span style="display:flex;"><span>npm install knex pg</span></span></code></pre></div>

<details open class=" box cstyle notices tip">
  <summary class="box-label" tabindex="-1">
    <i class="fa-fw fas fa-lightbulb"></i> 
    Tip
  </summary>
  <div class="box-content">
<p>You can replace <code>pg</code> with the database engine of your choice. Modifications must be made below to match that engine; refer to the <a href="https://knexjs.org/guide/" rel="external" target="_blank">Knex</a> documentation.</p>
  </div>
</details>
<p>Once Knex is installed, we&rsquo;ll run a few additional commands inside of the container to configure it.</p>
<h2 id="create-knexfile">Create Knexfile</h2>
<p>The Knex library uses a special file called a <code>knexfile</code> to store some configuration information. We can create it using this command:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Docker project-server Terminal</span>
</span></span><span style="display:flex;"><span>npx knex init</span></span></code></pre></div>

<details open class=" box cstyle notices tip">
  <summary class="box-label" tabindex="-1">
    <i class="fa-fw fas fa-lightbulb"></i> 
    Tip
  </summary>
  <div class="box-content">
<p>In the documentation for Knex it will reference these commands as just <code>knex</code>. However, since they are installed by an <code>npm</code> package, they are not directly accessible in the system path inside the container. So, to get around that, we can prefix the command with <code>npx</code> to run commands from within an <code>npm</code> package. <a href="https://docs.npmjs.com/cli/v8/commands/npx" rel="external" target="_blank">npx documentation</a></p>
  </div>
</details>
<p>This should create a file <code>server/knexfile.js</code>.</p>
<p>Once that is done, we can close the terminal connected to the container using the <code>exit</code> command.</p>
<p>We&rsquo;ll replace the default contents of the <code>server/knexfile.js</code> with the following:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">// server/knexfile.js
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @type { Object.&lt;string, import(&#34;knex&#34;).Knex.Config&gt; }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">module</span>.<span style="color:#a6e22e">exports</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">development</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">client</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;pg&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">connection</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">host</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">POSTGRES_HOST</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">port</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">POSTGRES_PORT</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">user</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">POSTGRES_USER</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">password</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">POSTGRES_PASSWORD</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">database</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">POSTGRES_DB</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">migrations</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">tableName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;migrations&#39;</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">production</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">client</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;pg&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">connection</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">host</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">POSTGRES_HOST</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">port</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">POSTGRES_PORT</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">user</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">POSTGRES_USER</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">password</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">POSTGRES_PASSWORD</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">database</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">POSTGRES_DB</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">migrations</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">tableName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;migrations&#39;</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>This will use environment variables to configure the database in both development and production modes.</p>
<h2 id="pass-environment-to-containers">Pass Environment to Containers</h2>
<p>Next we&rsquo;ll need to reconfigure our containers to pass the environment from the <code>.env</code> file. To do this, we&rsquo;ll edit the server service in the Docker Compose file:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>  <span style="color:#75715e"># server</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">project-server</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">build</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># location of Dockerfile</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">context</span>: <span style="color:#ae81ff">./server</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">project-server</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># set the user ID to match our user</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">user</span>: <span style="color:#e6db74">&#34;1000&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">depends_on</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># requires database to start</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">project-db</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">networks</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">project-network</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># allow external connections (remove this in production)</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># mount code into container</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./server:/app/server</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># maintain existing node_modules in container</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">/app/server/node_modules</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#f92672">env_file</span>:
</span></span><span style="display:flex; background-color:#3c3d38"><span>      <span style="color:#75715e"># load environment file into container environment</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>      - <span style="color:#ae81ff">.env</span></span></span></code></pre></div>
<p>This will load the entire contents of the <code>.env</code> file into the container&rsquo;s environment. This is a bit different than how we handled the database container, since we only passed it a few variables. Refer to <a href="https://docs.docker.com/compose/environment-variables/set-environment-variables/" rel="external" target="_blank">Docker Compose Environment Documentation</a> for details.</p>
<h2 id="recreate-container">Recreate Container</h2>
<p>Once we&rsquo;ve made that change, we need to recreate our container with the new environment.</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Terminal</span>
</span></span><span style="display:flex;"><span>docker compose up -d</span></span></code></pre></div>
<p>This will give us access to the information needed to connect to the database.</p>
<h2 id="create-migration">Create Migration</h2>
<p>We can use Knex to create a migration for our database. First, we must connect to it:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Terminal</span>
</span></span><span style="display:flex;"><span>docker exec -it project-server bash</span></span></code></pre></div>
<p>Then we can create a migration:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Docker project-server Terminal</span>
</span></span><span style="display:flex;"><span>npx knex migrate:make users</span></span></code></pre></div>

<details open class=" box cstyle notices tip">
  <summary class="box-label" tabindex="-1">
    <i class="fa-fw fas fa-lightbulb"></i> 
    Tip
  </summary>
  <div class="box-content">
<p>Use the same user ID and group ID found earlier when setting up the projects.</p>
  </div>
</details>
<p>This will create a file in the <code>migrations</code> directory that includes a timestamp and the name of the migration. The timestamp is included to ensure the migrations are applied in the correct order.</p>
<h2 id="add-users-table">Add Users Table</h2>
<p>Now, open the file created in the <code>migrations</code> directory and add the following content:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param { import(&#34;knex&#34;).Knex } knex
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @returns { Promise&lt;void&gt; }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">exports</span>.<span style="color:#a6e22e">up</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">knex</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">knex</span>.<span style="color:#a6e22e">schema</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">createTable</span>(<span style="color:#e6db74">&#39;users&#39;</span>, <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">table</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">table</span>.<span style="color:#a6e22e">increments</span>(<span style="color:#e6db74">&#39;id&#39;</span>)
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">table</span>.<span style="color:#a6e22e">string</span>(<span style="color:#e6db74">&#39;username&#39;</span>, <span style="color:#ae81ff">20</span>).<span style="color:#a6e22e">unique</span>().<span style="color:#a6e22e">notNullable</span>()
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">table</span>.<span style="color:#a6e22e">string</span>(<span style="color:#e6db74">&#39;passhash&#39;</span>, <span style="color:#ae81ff">60</span>).<span style="color:#a6e22e">notNullable</span>()
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">table</span>.<span style="color:#a6e22e">string</span>(<span style="color:#e6db74">&#39;name&#39;</span>, <span style="color:#ae81ff">255</span>).<span style="color:#a6e22e">notNullable</span>()
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">table</span>.<span style="color:#a6e22e">string</span>(<span style="color:#e6db74">&#39;email&#39;</span>, <span style="color:#ae81ff">255</span>).<span style="color:#a6e22e">notNullable</span>()
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">table</span>.<span style="color:#a6e22e">timestamps</span>()
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param { import(&#34;knex&#34;).Knex } knex
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @returns { Promise&lt;void&gt; }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">exports</span>.<span style="color:#a6e22e">down</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">knex</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">knex</span>.<span style="color:#a6e22e">schema</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">dropTable</span>(<span style="color:#e6db74">&#39;users&#39;</span>)
</span></span><span style="display:flex;"><span>};</span></span></code></pre></div>
<p>This will create a <code>users</code> table with a few columns. You can find more information about creating migrations with Knex in the <a href="https://knexjs.org/guide/schema-builder.html" rel="external" target="_blank">Schema Builder Documentation</a>.</p>
<p>Once we&rsquo;ve created that file, we can apply the migration using the <code>knex</code> command line tool:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Docker project-server Terminal</span>
</span></span><span style="display:flex;"><span>npx knex migrate:up</span></span></code></pre></div>
<p>If everything works correctly, you&rsquo;ll get a success message. You can check that the table exists in the database using various tools to query a Postgres database.</p>
<h2 id="create-seed">Create Seed</h2>
<p>You can also use Knex to seed some initial data into the database. First, create a seed file from inside the project-server Docker container:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Docker project-server Terminal</span>
</span></span><span style="display:flex;"><span>npx knex seed:make users_seed</span></span></code></pre></div>
<p>This will create a file <code>users_seed.js</code> in the <code>seeds</code> directory. Add the following content to that file:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param { import(&#34;knex&#34;).Knex } knex
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @returns { Promise&lt;void&gt; } 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">exports</span>.<span style="color:#a6e22e">seed</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">knex</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Get current date
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">now</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Date().<span style="color:#a6e22e">toISOString</span>().<span style="color:#a6e22e">slice</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">19</span>).<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">&#39;T&#39;</span>, <span style="color:#e6db74">&#39; &#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Deletes ALL existing entries
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">knex</span>(<span style="color:#e6db74">&#39;users&#39;</span>).<span style="color:#a6e22e">del</span>()
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">knex</span>(<span style="color:#e6db74">&#39;users&#39;</span>).<span style="color:#a6e22e">insert</span>([
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">username</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;admin&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">passhash</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;$2y$10$41NXCocgYzuOGgOB4aL1M.wg7mZT.P6NY9D9EbfdKu8xbHU8x0b3O&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Administrator&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">email</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;admin@local.local&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">created_at</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">now</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">updated_at</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">now</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">username</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;user&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">passhash</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;$2y$10$41NXCocgYzuOGgOB4aL1M.wg7mZT.P6NY9D9EbfdKu8xbHU8x0b3O&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;User&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">email</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;user@local.local&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">created_at</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">now</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">updated_at</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">now</span>,
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]);
</span></span><span style="display:flex;"><span>};</span></span></code></pre></div>
<p>We can now apply that seed file using the <code>knex</code> command line tool:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Docker project-server Terminal</span>
</span></span><span style="display:flex;"><span>npx knex seed:run</span></span></code></pre></div>
<p>You should now be able to see a couple of entries in the <code>users</code> table of the database. You can check that these exist in the database using various tools to query a Postgres database.</p>
<h2 id="helpful-scripts">Helpful Scripts</h2>
<p>It is very helpful to have a script that will allow you to reset your database while working on it. I recommend adding the following <code>reset</code> to your <code>package.json</code> file for the server:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;scripts&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;dev&#34;</span>: <span style="color:#e6db74">&#34;nodemon ./bin/www&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;start&#34;</span>: <span style="color:#e6db74">&#34;NODE_ENV=production node ./bin/www&#34;</span>,
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#f92672">&#34;reset&#34;</span>: <span style="color:#e6db74">&#34;knex migrate:rollback --all &amp;&amp; knex migrate:latest &amp;&amp; knex seed:run&#34;</span>
</span></span><span style="display:flex;"><span>  }</span></span></code></pre></div>
<p>With that script in the <code>package.json</code> file, you can use the following command to fully reset the database back to the default state:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Docker project-server Terminal</span>
</span></span><span style="display:flex;"><span>npm run reset</span></span></code></pre></div>
<p>This will undo all database migrations, redo them, and seed the database with your initial seed data.</p>

<details open class=" box cstyle notices note">
  <summary class="box-label" tabindex="-1">
    <i class="fa-fw fas fa-exclamation-circle"></i> 
    Note
  </summary>
  <div class="box-content">
<p>You may also wish to look into <a href="https://vincit.github.io/objection.js/" rel="external" target="_blank">Objection.js</a>, which is a great ORM that works well with Knex.</p>
  </div>
</details>

  <footer class="footline">
  </footer>
</article>
          </section>
<article class="default">
  <header class="headline">
  </header>

<h1 id="setting-up-a-canvas-course">Setting Up a Canvas Course</h1>

<p>Setting up a Canvas course to connect with a Codio Course.</p>
<ol>
<li>Connect the Canvas course to the Codio organization</li>
<li>Connect the Canvas course to the Codio course</li>
<li>Connect a Canvas assignment to a Codio assignment</li>
</ol>
<p>Please note that this video assumes that you have already set-up a Codio course and have the LTI settings configured.</p>
<p>Here is a video you can follow along with or you can follow through this Chapters pages.</p>
<p><a href="https://www.youtube.com/watch?v=wzzIYT5iyvE">YouTube Video</a></p>

  <footer class="footline">
  </footer>
</article>
          <section>
            <h1 class="a11y-only">Subsections of Setting Up a Canvas Course</h1>
<article class="default">
  <header class="headline">
  </header>

<h1 id="canvas-to-codio-org">Canvas to Codio Org</h1>

<p><a href="https://www.youtube.com/watch?v=wzzIYT5iyvE%3fstart%3d102">YouTube Video</a></p>
<p>The first step in creating a new Canvas course that you want to connect to a Codio course, is connecting the Canvas course to the Codio Organization.</p>
<h1 id="install-codio">Install Codio</h1>
<p>By default, Codio is not an installed app on Canvas. You will need to install the app.
<a href="#R-image-b5a7424426f31f58d13ee0abcee66fd6" class="lightbox-link"><img alt="Canvas" class="border lazy lightbox figure-image" loading="lazy" src="/extras/images/settings-apps.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-b5a7424426f31f58d13ee0abcee66fd6"><img alt="Canvas" class="border lazy lightbox lightbox-image" loading="lazy" src="/extras/images/settings-apps.png"></a></p>
<p><a href="#R-image-33638017866987f38fe5475cc463a085" class="lightbox-link"><img alt="Canvas" class="border lazy lightbox figure-image" loading="lazy" src="/extras/images/install-codio.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-33638017866987f38fe5475cc463a085"><img alt="Canvas" class="border lazy lightbox lightbox-image" loading="lazy" src="/extras/images/install-codio.png"></a></p>
<p>Once you install it, you will be prompted to enter the &lsquo;Consumer Key&rsquo; and &lsquo;Secret Key&rsquo;</p>
<p><a href="#R-image-ff52703751ca738852f181c465bd088d" class="lightbox-link"><img alt="Canvas" class="border lazy lightbox figure-image" loading="lazy" src="/extras/images/canvas-keys.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-ff52703751ca738852f181c465bd088d"><img alt="Canvas" class="border lazy lightbox lightbox-image" loading="lazy" src="/extras/images/canvas-keys.png"></a></p>

<details open class=" box cstyle notices tip">
  <summary class="box-label" tabindex="-1">
    <i class="fa-fw fas fa-lightbulb"></i> 
    Tip
  </summary>
  <div class="box-content">
<p>Canvas&rsquo;s &ldquo;Add App&rdquo; is requesting Codio&rsquo;s &ldquo;Organization&rdquo; information.</p>
  </div>
</details>
<p>To get these requested keys, you will need to do the following</p>
<h1 id="get-codio-lti-keys">Get Codio LTI Keys</h1>
<p>Open up the organization by selecting the button that looks like a power button. Then select &ldquo;Organizations&rdquo;
<a href="#R-image-d76e16b45574591189bd8c4e33b43351" class="lightbox-link"><img alt="Canvas" class="border lazy lightbox figure-image" loading="lazy" src="/extras/images/codio-orgs.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-d76e16b45574591189bd8c4e33b43351"><img alt="Canvas" class="border lazy lightbox lightbox-image" loading="lazy" src="/extras/images/codio-orgs.png"></a></p>

<details open class=" box cstyle notices tip">
  <summary class="box-label" tabindex="-1">
    <i class="fa-fw fas fa-lightbulb"></i> 
    Tip
  </summary>
  <div class="box-content">
<p>You might have just one organization and that is fine!</p>
  </div>
</details>
<p>If you have more than one organization, select the organization where the course was created. Once you select the organization, you will select &ldquo;LTI Integrations&rdquo;.</p>
<h1 id="copy-the-keys">Copy the Keys</h1>
<p>You will copy Codio&rsquo;s &ldquo;LTI Consumer&rdquo; into Canvas&rsquo;s &ldquo;Consumer Key&rdquo; and Codio&rsquo;s &ldquo;LTI Secret&rdquo; into Canvas&rsquo;s &ldquo;Shared Secret&rdquo;.</p>
<p><a href="#R-image-8a4772bb02ba3446392bb4555d1c071a" class="lightbox-link"><img alt="Canvas" class="border lazy lightbox figure-image" loading="lazy" src="/extras/images/codio-keys.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-8a4772bb02ba3446392bb4555d1c071a"><img alt="Canvas" class="border lazy lightbox lightbox-image" loading="lazy" src="/extras/images/codio-keys.png"></a></p>
<p><a href="#R-image-1720c5a812a263a9eadc3a972e410253" class="lightbox-link"><img alt="Canvas" class="border lazy lightbox figure-image" loading="lazy" src="/extras/images/canvas-keys.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-1720c5a812a263a9eadc3a972e410253"><img alt="Canvas" class="border lazy lightbox lightbox-image" loading="lazy" src="/extras/images/canvas-keys.png"></a></p>
<h1 id="launch-url">Launch URL</h1>
<p>The last step is to set up the launch url in Canvas. To access this, you will need to open the Codio app in Canvas</p>
<p><a href="#R-image-f906f9addf7ce19d3a809d2f95eb4e61" class="lightbox-link"><img alt="Canvas" class="border lazy lightbox figure-image" loading="lazy" src="/extras/images/canvas-config-codio.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f906f9addf7ce19d3a809d2f95eb4e61"><img alt="Canvas" class="border lazy lightbox lightbox-image" loading="lazy" src="/extras/images/canvas-config-codio.png"></a></p>
<p><a href="#R-image-5e4d59178d292d311f339eaa01e81ef5" class="lightbox-link"><img alt="Canvas" class="border lazy lightbox figure-image" loading="lazy" src="/extras/images/canvas-codio-edit.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-5e4d59178d292d311f339eaa01e81ef5"><img alt="Canvas" class="border lazy lightbox lightbox-image" loading="lazy" src="/extras/images/canvas-codio-edit.png"></a></p>
<p><a href="#R-image-8f7a0e7ca2e55aae4d8cd6227bafb94c" class="lightbox-link"><img alt="Canvas" class="border lazy lightbox figure-image" loading="lazy" src="/extras/images/canvas-launch-url.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-8f7a0e7ca2e55aae4d8cd6227bafb94c"><img alt="Canvas" class="border lazy lightbox lightbox-image" loading="lazy" src="/extras/images/canvas-launch-url.png"></a></p>
<p><a href="#R-image-078f0356109dd2733cd865779657034d" class="lightbox-link"><img alt="Canvas" class="border lazy lightbox figure-image" loading="lazy" src="/extras/images/codio-launch-url.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-078f0356109dd2733cd865779657034d"><img alt="Canvas" class="border lazy lightbox lightbox-image" loading="lazy" src="/extras/images/codio-launch-url.png"></a></p>

<details open class=" box cstyle notices tip">
  <summary class="box-label" tabindex="-1">
    <i class="fa-fw fas fa-lightbulb"></i> 
    Tip
  </summary>
  <div class="box-content">
<p>Unless the &ldquo;Secret Key&rdquo; in Codio gets changed, we won&rsquo;t have to worry about these values in the future.</p>
  </div>
</details>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="canvas-to-codio-course">Canvas to Codio Course</h1>

<p><a href="https://www.youtube.com/watch?v=wzzIYT5iyvE%3fstart%3d191">YouTube Video</a></p>
<p>Once you have the Canvas course connected to the Codio Organization, you can connect the Canvas course to the Codio Course.</p>
<p>As with the connection to the Codio organization, you will edit the Codio app configurations in Canvas.</p>
<p><a href="#R-image-75edae48e29cd60ec1743409ffd0487c" class="lightbox-link"><img alt="Canvas" class="border lazy lightbox figure-image" loading="lazy" src="/extras/images/canvas-codio-edit.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-75edae48e29cd60ec1743409ffd0487c"><img alt="Canvas" class="border lazy lightbox lightbox-image" loading="lazy" src="/extras/images/canvas-codio-edit.png"></a></p>
<p>This step only requires that you update the &ldquo;Custom Fields&rdquo;</p>
<p><a href="#R-image-cd5f3c542d7d284a04a41787912b2b0a" class="lightbox-link"><img alt="Canvas" class="border lazy lightbox figure-image" loading="lazy" src="/extras/images/canvas-fields.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-cd5f3c542d7d284a04a41787912b2b0a"><img alt="Canvas" class="border lazy lightbox lightbox-image" loading="lazy" src="/extras/images/canvas-fields.png"></a></p>
<p>The particular field gets two values from Codio: &ldquo;codio_course_target_id&rdquo; and &ldquo;codio_parent_course_id&rdquo;. To get these, open the Codio course and select &ldquo;LTI/LMS&rdquo;. Copy these two fields and paste them into the Canvas &ldquo;Custom Fields&rdquo;, one per line.</p>
<p><a href="#R-image-414e7497954c62b1a0eb3a1622dcd4c5" class="lightbox-link"><img alt="Canvas" class="border lazy lightbox figure-image" loading="lazy" src="/extras/images/codio-parent-target.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-414e7497954c62b1a0eb3a1622dcd4c5"><img alt="Canvas" class="border lazy lightbox lightbox-image" loading="lazy" src="/extras/images/codio-parent-target.png"></a></p>

<details open class=" box cstyle notices tip">
  <summary class="box-label" tabindex="-1">
    <i class="fa-fw fas fa-lightbulb"></i> 
    Tip
  </summary>
  <div class="box-content">
<p>When we clone the course, we will refer to these values again.</p>
  </div>
</details>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="canvas-to-codio-assignment">Canvas to Codio Assignment</h1>

<p><a href="https://www.youtube.com/watch?v=wzzIYT5iyvE%3fstart%3d229">YouTube Video</a></p>
<p>In this part, we will be adding assignments to the Canvas course.</p>
<p>The key parts of this step are to have the submission type be an &ldquo;External Tool&rdquo; and &ldquo;Load in a New Tab&rdquo;.</p>
<p>You will need to get the assignment URL from Codio.</p>
<p><a href="#R-image-95c9ad3ebf52cd7d0aeae86a6566d091" class="lightbox-link"><img alt="Canvas" class="border lazy lightbox figure-image" loading="lazy" src="/extras/images/codio-assn-lti.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-95c9ad3ebf52cd7d0aeae86a6566d091"><img alt="Canvas" class="border lazy lightbox lightbox-image" loading="lazy" src="/extras/images/codio-assn-lti.png"></a></p>
<h3 id="accessing-all-ltilms-urls">Accessing All LTI/LMS URLs</h3>
<p>When first setting up a course, it is helpful to export the Assignment URLs.</p>
<p><a href="#R-image-6dc898cae058e3cf098c7f8851077c10" class="lightbox-link"><img alt="Canvas" class="border lazy lightbox figure-image" loading="lazy" src="/extras/images/codio-course-lti.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-6dc898cae058e3cf098c7f8851077c10"><img alt="Canvas" class="border lazy lightbox lightbox-image" loading="lazy" src="/extras/images/codio-course-lti.png"></a>
<a href="#R-image-f0e2792f0a47adcc19423eeaa983bc10" class="lightbox-link"><img alt="Canvas" class="border lazy lightbox figure-image" loading="lazy" src="/extras/images/codio-all-assns-lti.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f0e2792f0a47adcc19423eeaa983bc10"><img alt="Canvas" class="border lazy lightbox lightbox-image" loading="lazy" src="/extras/images/codio-all-assns-lti.png"></a></p>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="cloning-a-canvas-course">Cloning a Canvas Course</h1>

<p>Video to come!</p>

  <footer class="footline">
  </footer>
</article>
          </section>
<article class="default">
  <header class="headline">
  </header>

<h1 id="deployment-example">Deployment Example</h1>

<p>A deployable web application example.</p>

  <footer class="footline">
  </footer>
</article>
          <section>
            <h1 class="a11y-only">Subsections of Deployment Example</h1>
<article class="default">
  <header class="headline">
  </header>

<h1 id="instructions">Instructions</h1>

<h2 id="setup-dev-container">Setup Dev Container</h2>
<p>Follow the steps on this page to create a new devcontainer and GitHub Codespace: <a href="https://textbooks.cs.ksu.edu/cis526/x-examples/01-express-starter/01-codespace/index.html" rel="external" target="_blank">https://textbooks.cs.ksu.edu/cis526/x-examples/01-express-starter/01-codespace/index.html</a>.</p>
<p>Choose the <strong>Node.js &amp; PostgreSQL</strong> container type with Node version <strong>22-bookworm</strong>.</p>
<h2 id="setup-server">Setup Server</h2>
<p>Follow the steps on this page to create a new Express server: <a href="https://textbooks.cs.ksu.edu/cis526/x-examples/01-express-starter/02-express-starter/index.html" rel="external" target="_blank">https://textbooks.cs.ksu.edu/cis526/x-examples/01-express-starter/02-express-starter/index.html</a></p>
<p>Use the <code>npm-check-updates</code> comamnd to update all installed packages.</p>
<h2 id="environment">Environment</h2>
<p>Install dotenvx as shown on this page: <a href="https://textbooks.cs.ksu.edu/cis526/x-examples/01-express-starter/07-environment/index.html" rel="external" target="_blank">https://textbooks.cs.ksu.edu/cis526/x-examples/01-express-starter/07-environment/index.html</a></p>
<p>Add to top of <code>app.js</code></p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;@dotenvx/dotenvx&#39;</span>).<span style="color:#a6e22e">config</span>()</span></span></code></pre></div>
<p>Create <code>.env</code> file with these contents:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-env" data-lang="env"><span style="display:flex;"><span>port<span style="color:#f92672">=</span><span style="color:#ae81ff">3000</span></span></span></code></pre></div>
<h2 id="database">Database</h2>
<p>Install libraries:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ npm install sequelize umzug pg pg-hstore</span></span></code></pre></div>
<p>Database configuration file <code>config/database.js</code>:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">Sequelize</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;sequelize&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sequelize</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Sequelize</span>({
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Supports &#34;sqlite&#34; or &#34;postgres&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">dialect</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;postgres&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">host</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">DATABASE_HOST</span> <span style="color:#f92672">||</span> <span style="color:#e6db74">&#34;db&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">port</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">DATABASE_PORT</span> <span style="color:#f92672">||</span> <span style="color:#ae81ff">5432</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">username</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">DATABASE_USERNAME</span> <span style="color:#f92672">||</span> <span style="color:#e6db74">&#34;postgres&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">password</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">DATABASE_PASSWORD</span> <span style="color:#f92672">||</span> <span style="color:#e6db74">&#34;postgres&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">database</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">DATABASE_NAME</span> <span style="color:#f92672">||</span> <span style="color:#e6db74">&#34;postgres&#34;</span>,
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">module</span>.<span style="color:#a6e22e">exports</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">sequelize</span>;</span></span></code></pre></div>
<p>Update <code>.env</code> file with environment:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-env" data-lang="env"><span style="display:flex;"><span>PORT<span style="color:#f92672">=</span><span style="color:#ae81ff">3000</span>
</span></span><span style="display:flex;"><span>DATABASE_HOST<span style="color:#f92672">=</span>db
</span></span><span style="display:flex;"><span>DATABASE_PORT<span style="color:#f92672">=</span><span style="color:#ae81ff">5432</span>
</span></span><span style="display:flex;"><span>DATABASE_USERNAME<span style="color:#f92672">=</span>postgres
</span></span><span style="display:flex;"><span>DATABASE_PASSWORD<span style="color:#f92672">=</span>postgres
</span></span><span style="display:flex;"><span>DATABASE_NAME<span style="color:#f92672">=</span>postgres</span></span></code></pre></div>
<h2 id="database-migrations">Database Migrations</h2>
<p>Create migration configuration <code>config/migrations.js</code></p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">Umzug</span>, <span style="color:#a6e22e">SequelizeStorage</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;umzug&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">database</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;./database&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">umzug</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Umzug</span>({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">migrations</span><span style="color:#f92672">:</span> {<span style="color:#a6e22e">glob</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;migrations/*.js&#39;</span>},
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">context</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">getQueryInterface</span>(),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">storage</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SequelizeStorage</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">sequelize</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">database</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">modelName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;migrations&#39;</span>
</span></span><span style="display:flex;"><span>    }),
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">module</span>.<span style="color:#a6e22e">exports</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">umzug</span>;</span></span></code></pre></div>
<p>Create script <code>migrate.js</code></p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;@dotenvx/dotenvx&#39;</span>).<span style="color:#a6e22e">config</span>()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">migrations</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;./config/migrations&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">migrations</span>.<span style="color:#a6e22e">runAsCLI</span>()</span></span></code></pre></div>
<p>Create migration <code>migrations/00_users.js</code></p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">Sequelize</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;sequelize&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">up</span>({<span style="color:#a6e22e">context</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">queryInterface</span>}) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">queryInterface</span>.<span style="color:#a6e22e">createTable</span>(<span style="color:#e6db74">&#39;users&#39;</span>, {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Sequelize</span>.<span style="color:#a6e22e">INTEGER</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">primaryKey</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">autoIncrement</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">username</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Sequelize</span>.<span style="color:#a6e22e">STRING</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">unique</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">allowNull</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">createdAt</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Sequelize</span>.<span style="color:#a6e22e">DATE</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">allowNull</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">updatedAt</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Sequelize</span>.<span style="color:#a6e22e">DATE</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">allowNull</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">down</span>({<span style="color:#a6e22e">context</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">queryInterface</span>}) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">queryInterface</span>.<span style="color:#a6e22e">dropTable</span>(<span style="color:#e6db74">&#39;users&#39;</span>);
</span></span><span style="display:flex;"><span>} 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">module</span>.<span style="color:#a6e22e">exports</span> <span style="color:#f92672">=</span> {<span style="color:#a6e22e">up</span>, <span style="color:#a6e22e">down</span>}</span></span></code></pre></div>
<p>Run migration</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>node migrate up</span></span></code></pre></div>
<h2 id="seeds">Seeds</h2>
<p>Create seed configration <code>config/seeds.js</code></p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">Umzug</span>, <span style="color:#a6e22e">SequelizeStorage</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;umzug&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">database</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;./database&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">umzug</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Umzug</span>({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">migrations</span><span style="color:#f92672">:</span> {<span style="color:#a6e22e">glob</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;seeds/*.js&#39;</span>},
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">context</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">getQueryInterface</span>(),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">storage</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SequelizeStorage</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">sequelize</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">database</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">modelName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;seeds&#39;</span>
</span></span><span style="display:flex;"><span>    }),
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">module</span>.<span style="color:#a6e22e">exports</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">umzug</span>;</span></span></code></pre></div>
<p>Create script <code>seed.js</code></p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;@dotenvx/dotenvx&#39;</span>).<span style="color:#a6e22e">config</span>()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">seeds</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;./config/seeds&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">seeds</span>.<span style="color:#a6e22e">runAsCLI</span>()</span></span></code></pre></div>
<p>Create seed file <code>seeds/00_users.js</code></p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">Sequelize</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;sequelize&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Timestamp in the appropriate format for the database
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">now</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Date().<span style="color:#a6e22e">toISOString</span>().<span style="color:#a6e22e">slice</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">23</span>).<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">&#34;T&#34;</span>, <span style="color:#e6db74">&#34; &#34;</span>) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; +00:00&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Array of objects to add to the database
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">users</span> <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">username</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;admin&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">createdAt</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">now</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">updatedAt</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">now</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">username</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;contributor&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">createdAt</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">now</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">updatedAt</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">now</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">username</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;manager&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">createdAt</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">now</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">updatedAt</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">now</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">4</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">username</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;user&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">createdAt</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">now</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">updatedAt</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">now</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">up</span>({<span style="color:#a6e22e">context</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">queryInterface</span>}) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">queryInterface</span>.<span style="color:#a6e22e">bulkInsert</span>(<span style="color:#e6db74">&#39;users&#39;</span>, <span style="color:#a6e22e">users</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">queryInterface</span>.<span style="color:#a6e22e">sequelize</span>.<span style="color:#a6e22e">query</span>(<span style="color:#e6db74">&#34;SELECT setval(&#39;users_id_seq&#39;, max(id)) FROM users;&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">down</span>({<span style="color:#a6e22e">context</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">queryInterface</span>}) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">queryInterface</span>.<span style="color:#a6e22e">bulkDelete</span>(<span style="color:#e6db74">&#34;users&#34;</span>, {}, { <span style="color:#a6e22e">truncate</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> });
</span></span><span style="display:flex;"><span>} 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">module</span>.<span style="color:#a6e22e">exports</span> <span style="color:#f92672">=</span> {<span style="color:#a6e22e">up</span>, <span style="color:#a6e22e">down</span>}</span></span></code></pre></div>
<h2 id="automation">Automation</h2>
<p>Update <code>bin/www</code> file to automate migration and seeding:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/env node
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Module dependencies.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">app</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;../app&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">debug</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;debug&#39;</span>)(<span style="color:#e6db74">&#39;server:server&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">http</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;http&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">database</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;../config/database&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">migrations</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;../config/migrations&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">seeds</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;../config/seeds&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Get port from environment and store in Express.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">port</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">normalizePort</span>(<span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">PORT</span> <span style="color:#f92672">||</span> <span style="color:#e6db74">&#39;3000&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">set</span>(<span style="color:#e6db74">&#39;port&#39;</span>, <span style="color:#a6e22e">port</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Create HTTP server.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">server</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">createServer</span>(<span style="color:#a6e22e">app</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Listen on provided port, on all network interfaces.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// server.listen(port)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;error&#39;</span>, <span style="color:#a6e22e">onError</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;listening&#39;</span>, <span style="color:#a6e22e">onListening</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Call startup function
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">startup</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">startup</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Test database connection
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">authenticate</span>().<span style="color:#a6e22e">then</span>(() =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;Database connection successful&#34;</span>)
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Run migrations
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">migrations</span>.<span style="color:#a6e22e">up</span>().<span style="color:#a6e22e">then</span>(() =&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;Database migrations complete&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">SEED_DATA</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;true&#39;</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;Database data seeding is enabled!&#34;</span>)
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">seeds</span>.<span style="color:#a6e22e">up</span>().<span style="color:#a6e22e">then</span>(() =&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;Database seeding complete&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">listen</span>(<span style="color:#a6e22e">port</span>)
</span></span><span style="display:flex;"><span>          })
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// Listen on provided port, on all network interfaces.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">listen</span>(<span style="color:#a6e22e">port</span>)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      })
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">error</span>){
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">logger</span>.<span style="color:#a6e22e">error</span>(<span style="color:#a6e22e">error</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ======= other code here ========
</span></span></span></code></pre></div>
<p>Update <code>.env</code> file with environment:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-env" data-lang="env"><span style="display:flex;"><span>PORT<span style="color:#f92672">=</span><span style="color:#ae81ff">3000</span>
</span></span><span style="display:flex;"><span>DATABASE_HOST<span style="color:#f92672">=</span>db
</span></span><span style="display:flex;"><span>DATABASE_PORT<span style="color:#f92672">=</span><span style="color:#ae81ff">5432</span>
</span></span><span style="display:flex;"><span>DATABASE_USERNAME<span style="color:#f92672">=</span>postgres
</span></span><span style="display:flex;"><span>DATABASE_PASSWORD<span style="color:#f92672">=</span>postgres
</span></span><span style="display:flex;"><span>DATABASE_NAME<span style="color:#f92672">=</span>postgres
</span></span><span style="display:flex;"><span>SEED_DATA<span style="color:#f92672">=</span>true</span></span></code></pre></div>
<h2 id="database-models">Database Models</h2>
<p>Create model <code>models/models.js</code></p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">Sequelize</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;sequelize&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">database</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;../config/database&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">UserSchema</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Sequelize</span>.<span style="color:#a6e22e">INTEGER</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">primaryKey</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">autoIncrement</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">username</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Sequelize</span>.<span style="color:#a6e22e">STRING</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">unique</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">allowNull</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">createdAt</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Sequelize</span>.<span style="color:#a6e22e">DATE</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">allowNull</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">updatedAt</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Sequelize</span>.<span style="color:#a6e22e">DATE</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">allowNull</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">User</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">database</span>.<span style="color:#a6e22e">define</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Model Name
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#e6db74">&#39;User&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Schema
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">UserSchema</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Other options
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">tableName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;users&#39;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">module</span>.<span style="color:#a6e22e">exports</span> <span style="color:#f92672">=</span> { <span style="color:#a6e22e">User</span> }</span></span></code></pre></div>
<h2 id="create-api-endpoint">Create API Endpoint</h2>
<p>Edit <code>routes/users.js</code></p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">express</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;express&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">router</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">express</span>.<span style="color:#a6e22e">Router</span>();
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">User</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;../models/models&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/* GET users listing. */</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/&#39;</span>, <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>, <span style="color:#a6e22e">next</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">users</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">User</span>.<span style="color:#a6e22e">findAll</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">json</span>(<span style="color:#a6e22e">users</span>)
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">module</span>.<span style="color:#a6e22e">exports</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">router</span>;</span></span></code></pre></div>
<p>Start the app and navigate to the <code>/users</code> route:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ npm start</span></span></code></pre></div>
<p>Should see API output. Great - server is working!</p>
<p>To prepare for Vue, update <code>app.js</code> to remove the <code>index</code> router.</p>
<h2 id="vue">Vue</h2>
<p>Create a Vue starter project as described here: <a href="https://textbooks.cs.ksu.edu/cis526/x-examples/05-vue-starter/01-vue-starter/index.html" rel="external" target="_blank">https://textbooks.cs.ksu.edu/cis526/x-examples/05-vue-starter/01-vue-starter/index.html</a></p>
<p>Can omit Pinia and Vitest features. Choose to skip all example code and start with a blank Vue project.</p>
<p>Npm install and check for updates</p>
<h2 id="proxy">Proxy</h2>
<p>Update <code>vite.config.js</code> to add proxy:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">// https://vite.dev/config/
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#a6e22e">defineConfig</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">plugins</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">vue</span>(),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">vueDevTools</span>(),
</span></span><span style="display:flex;"><span>  ],
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">resolve</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">alias</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#39;@&#39;</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">fileURLToPath</span>(<span style="color:#66d9ef">new</span> <span style="color:#a6e22e">URL</span>(<span style="color:#e6db74">&#39;./src&#39;</span>, <span style="color:#66d9ef">import</span>.<span style="color:#a6e22e">meta</span>.<span style="color:#a6e22e">url</span>))
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">server</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">proxy</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#39;/users&#39;</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">target</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;http://localhost:3000&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">changeOrigin</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">secure</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>})</span></span></code></pre></div>
<h2 id="api-call">API Call</h2>
<p>Update <code>src/App.vue</code> to call API</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-vue" data-lang="vue"><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">setup</span>&gt;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">ref</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;vue&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">users</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ref</span>([])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#39;/users/&#39;</span>).<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">response</span> =&gt; <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">json</span>())
</span></span><span style="display:flex;"><span>.<span style="color:#a6e22e">then</span>((<span style="color:#a6e22e">response</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">users</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">response</span>
</span></span><span style="display:flex;"><span>}).<span style="color:#66d9ef">catch</span>((<span style="color:#a6e22e">e</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#a6e22e">e</span>)
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">template</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">h1</span>&gt;<span style="color:#a6e22e">List</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">Users</span>&lt;/<span style="color:#f92672">h1</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">ul</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">li</span> <span style="color:#f92672">v-for</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;user in users&#34; :key=&#34;user.id&#34;</span>&gt;{{ <span style="color:#a6e22e">user.username</span> }}&lt;/<span style="color:#f92672">li</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">ul</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">template</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">style</span> <span style="color:#a6e22e">scoped</span>&gt;&lt;/<span style="color:#f92672">style</span>&gt;</span></span></code></pre></div>
<p>In two terminals, start server and client and open browser. Should see a list of users</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ cd server
</span></span><span style="display:flex;"><span>$ npm start</span></span></code></pre></div>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ cd client
</span></span><span style="display:flex;"><span>$ npm run dev</span></span></code></pre></div>
<h2 id="ready-for-deployment">Ready for Deployment</h2>
<p>Create <code>Dockerfile</code></p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Dockerfile" data-lang="Dockerfile"><span style="display:flex;"><span><span style="color:#75715e"># Node Version</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ARG</span> NODE_VERSION<span style="color:#f92672">=</span><span style="color:#ae81ff">22</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">###############################</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># STAGE 1 - BUILD CLIENT      #</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">###############################</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Client Base Image</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># See https://hub.docker.com/_/node/</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> node:${NODE_VERSION}-alpine as client</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Use production node environment by default</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENV</span> NODE_ENV production<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Store files in /usr/src/app</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> /usr/src/app</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Download dependencies as a separate step to take advantage of Docker&#39;s caching.</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Leverage a cache mount to /root/.npm to speed up subsequent builds.</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Leverage a bind mounts to package.json and package-lock.json to avoid having to copy them into</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># into this layer.</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># See https://docs.docker.com/build/cache/optimize/</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> --mount<span style="color:#f92672">=</span>type<span style="color:#f92672">=</span>bind,source<span style="color:#f92672">=</span>client/package.json,target<span style="color:#f92672">=</span>package.json <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --mount<span style="color:#f92672">=</span>type<span style="color:#f92672">=</span>bind,source<span style="color:#f92672">=</span>client/package-lock.json,target<span style="color:#f92672">=</span>package-lock.json <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --mount<span style="color:#f92672">=</span>type<span style="color:#f92672">=</span>cache,target<span style="color:#f92672">=</span>/root/.npm <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    npm ci --include<span style="color:#f92672">=</span>dev<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Copy the rest of the source files into the image.</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> ./client .<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Build the client application</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> npm run build<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">###############################</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># STAGE 2 - BUILD SERVER      #</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">###############################</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Server Base Image</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># See https://hub.docker.com/_/node/</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> node:${NODE_VERSION}-alpine as server</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Use production node environment by default</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENV</span> NODE_ENV production<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Store files in /usr/src/app</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> /usr/src/app</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Download dependencies as a separate step to take advantage of Docker&#39;s caching.</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Leverage a cache mount to /root/.npm to speed up subsequent builds.</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Leverage a bind mounts to package.json and package-lock.json to avoid having to copy them into</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># into this layer.</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># See https://docs.docker.com/build/cache/optimize/</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> --mount<span style="color:#f92672">=</span>type<span style="color:#f92672">=</span>bind,source<span style="color:#f92672">=</span>server/package.json,target<span style="color:#f92672">=</span>package.json <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --mount<span style="color:#f92672">=</span>type<span style="color:#f92672">=</span>bind,source<span style="color:#f92672">=</span>server/package-lock.json,target<span style="color:#f92672">=</span>package-lock.json <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --mount<span style="color:#f92672">=</span>type<span style="color:#f92672">=</span>cache,target<span style="color:#f92672">=</span>/root/.npm <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    npm ci --omit<span style="color:#f92672">=</span>dev<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Copy the rest of the source files into the image</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> ./server .<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Copy the built version of the client into the image</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> --from<span style="color:#f92672">=</span>client /usr/src/app/dist ./public<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Make a directory for the database and make it writable</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> mkdir -p ./data<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> chown -R node:node ./data<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Make a directory for the uploads and make it writable</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> mkdir -p ./public/uploads<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> chown -R node:node ./public/uploads<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Run the application as a non-root user.</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">USER</span><span style="color:#e6db74"> node</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Expose the port that the application listens on.</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">EXPOSE</span><span style="color:#e6db74"> 3000</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Command to check for a healthy application</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">HEALTHCHECK</span> CMD wget --no-verbose --tries<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> --spider http://localhost:3000/users <span style="color:#f92672">||</span> exit <span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Run the application.</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">CMD</span> npm run start</span></span></code></pre></div>
<h2 id="github-action-workflow">GitHub Action Workflow</h2>
<p>Create <code>.github/workflows/build_docker.yml</code></p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#75715e"># Workflow name</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">name</span>: <span style="color:#ae81ff">Build Docker</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Run only on new tags being pushed</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># https://docs.github.com/en/actions/using-workflows/triggering-a-workflow</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">on</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">push</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">tags</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#39;v*.*.*&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Define a single job named build</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">jobs</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">build</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Run job on Ubuntu runner</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-latest</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Job Steps</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># Step 1 - Checkout the Repository</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># https://github.com/actions/checkout</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">1</span> - <span style="color:#ae81ff">Checkout Repository</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/checkout@v4</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># Step 2 - Log In to GitHub Container Registry</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># https://github.com/docker/login-action</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">2</span> - <span style="color:#ae81ff">Login to GitHub Container Registry</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">docker/login-action@v3</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">registry</span>: <span style="color:#ae81ff">ghcr.io</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">username</span>: <span style="color:#ae81ff">${{ github.repository_owner }}</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">password</span>: <span style="color:#ae81ff">${{ secrets.GITHUB_TOKEN }}</span>
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># Step 3 - Build and Push Docker Image</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># https://github.com/docker/build-push-action</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">3</span> - <span style="color:#ae81ff">Build and Push Docker Image</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">docker/build-push-action@v6</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">context</span>: <span style="color:#ae81ff">.</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">push</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">tags</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            ghcr.io/${{ github.repository }}:${{ github.ref_name }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            ghcr.io/${{ github.repository }}:latest</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># Step 4 - Make Release on GitHub</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># https://github.com/softprops/action-gh-release</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">4</span> - <span style="color:#ae81ff">Release</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">softprops/action-gh-release@v2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">generate_release_notes</span>: <span style="color:#66d9ef">true</span></span></span></code></pre></div>
<h2 id="create-compose-file">Create Compose File</h2>
<p>Create <code>compose.yml</code></p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#f92672">services</span>:
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">######################################</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Deployment Example</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Repository:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># https://github.com/cis526-codio/ex-deploy</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">example-deploy</span>:
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Docker Image</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">ghcr.io/cis526-codio/ex-deploy:latest</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Container Name</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">example-deploy</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Restart Container Unless Stopped</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">restart</span>: <span style="color:#ae81ff">unless-stopped</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Networks</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">networks</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">example-deploy-network</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Network Ports</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;3000:3000&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Environment Variables</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># Seed initial data on first startup</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">SEED_DATA</span>: <span style="color:#e6db74">&#39;true&#39;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># Database</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">DATABASE_HOST</span>: <span style="color:#ae81ff">example-deploy-db</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">DATABASE_PORT</span>: <span style="color:#ae81ff">5432</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">DATABASE_USERNAME</span>: <span style="color:#ae81ff">example-deploy</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">DATABASE_PASSWORD</span>: <span style="color:#ae81ff">example-deploy</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">DATABASE_NAME</span>: <span style="color:#ae81ff">example-deploy</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">######################################</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Postgres Database</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Image Location:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># https://hub.docker.com/_/postgres</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">example-deploy-db</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Docker Image</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">postgres:17-alpine</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Container Name</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">example-deploy-db</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Restart Container Unless Stopped</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">restart</span>: <span style="color:#ae81ff">unless-stopped</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Networks</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">networks</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">example-deploy-network</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Volumes</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">example-deploy-db-data:/var/lib/postgresql/data:rw</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Environment Variables</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">POSTGRES_USER</span>: <span style="color:#ae81ff">example-deploy</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">POSTGRES_PASSWORD</span>: <span style="color:#ae81ff">example-deploy</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">POSTGRES_DB</span>: <span style="color:#ae81ff">example-deploy</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">example-deploy-db-data</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">networks</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">example-deploy-network</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">internal</span>: <span style="color:#66d9ef">true</span></span></span></code></pre></div>
<p>Commit a <code>v0.0.1</code> tag, deploy, and enjoy!</p>

  <footer class="footline">
  </footer>
</article>
          </section>
          </section>
        </div>
      </main>
<div class="git-footer">
  <p class="theme-version-footer">8.0.0</p>
<p>Last modified by:
              <i class='fa-fw fas fa-user'></i> Russell Feldhausen
              <i class='fas fa-calendar'></i> <a href="https://github.com/ksu-cs-textbooks/extras/commit/2e7edc71e4e6774594eef5cc2c3bf94f7b1d713d">Dec 7, 2022</a>
</p>

</div>
    </div>
    <script src="/extras/js/clipboard/clipboard.min.js?1757555851" defer></script>
    <script src="/extras/js/perfect-scrollbar/perfect-scrollbar.min.js?1757555851" defer></script>
    <script src="/extras/js/theme.min.js?1757555851" defer></script>
  </body>
</html>
