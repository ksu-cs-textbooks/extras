




	
	
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.101.0">
    <meta name="generator" content="Relearn 5.2.0+tip">
    <meta name="robots" content="noindex, nofollow, noarchive, noimageindex">
    <meta name="description" content="K-State CS Textbook Extras">
    <meta name="author" content="Russell Feldhausen">
    <title>Docker :: K-State CS Textbook Extras</title>
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="https://ksu-cs-textbooks.github.io/hugo-starter/css/fontawesome-all.min.css?1689016652" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/hugo-starter/css/fontawesome-all.min.css?1689016652" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/hugo-starter/css/featherlight.min.css?1689016652" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/hugo-starter/css/featherlight.min.css?1689016652" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/hugo-starter/css/auto-complete.css?1689016652" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/hugo-starter/css/auto-complete.css?1689016652" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/hugo-starter/css/perfect-scrollbar.min.css?1689016652" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/hugo-starter/css/nucleus.css?1689016652" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/hugo-starter/css/fonts.css?1689016652" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/hugo-starter/css/fonts.css?1689016652" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/hugo-starter/css/theme.css?1689016652" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/hugo-starter/css/theme-light-theme.css?1689016652" rel="stylesheet" id="variant-style">
    <link href="https://ksu-cs-textbooks.github.io/hugo-starter/css/ie.css?1689016652" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/hugo-starter/css/variant.css?1689016652" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/hugo-starter/css/print.css?1689016652" rel="stylesheet" media="print">
    <script src="https://ksu-cs-textbooks.github.io/hugo-starter/js/variant.js?1689016652"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      var index_url="https://ksu-cs-textbooks.github.io/hugo-starter/index.json";
      var root_url="https://ksu-cs-textbooks.github.io/hugo-starter/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copy to clipboard';
      window.T_Copied_to_clipboard = 'Copied to clipboard!';
      window.T_Copy_link_to_clipboard = 'Copy link to clipboard';
      window.T_Link_copied_to_clipboard = 'Copied link to clipboard!';
      // some further base stuff
      var baseUriFull='https:\/\/ksu-cs-textbooks.github.io\/hugo-starter/';
      window.variants && variants.init( [ 'light-theme', 'dark-theme' ] );
    </script>
    
    <link href="https://ksu-cs-textbooks.github.io/hugo-starter/css/custom.css?1689016652" rel="stylesheet">
    <script src="https://ksu-cs-textbooks.github.io/hugo-starter/js/jquery.min.js?1689016652" defer></script>

  </head>
  <body class="mobile-support tele disableInlineCopyToClipboard" data-url="https://ksu-cs-textbooks.github.io/hugo-starter/02-full-stack/04-docker/">
    
    <div id="tele" class="tele mirror">
    
    <div id="body" class="default-animation">
      
      
      
      <main id="body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <div id="head-tags">
          </div>
          <article class="default">
<h1>Docker</h1>

  
  
<div class="box notices cstyle note">
    <div class="box-label"><i class="fa-fw fas fa-exclamation-circle"></i> Note</div>
    <div class="box-content">
<p>If you have already created projects locally, skip down to the 

<a href="https://ksu-cs-textbooks.github.io/hugo-starter/02-full-stack/04-docker/#01">Remove Node Modules</a> section below. You can Dockerize existing projects as well!</p>
    </div>
</div>
<h2 id="get-effective-ids">Get Effective IDs</h2>
<p>First, we need to make a note of our effective user ID and group ID in the terminal:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Terminal</span>
</span></span><span style="display:flex;"><span>id
</span></span></code></pre></div><p>You should get output that begins with something similar to this:</p>
<pre tabindex="0"><code>uid=1000(youboon2) gid=1000(youboon2)
</code></pre><p>Remember those two numbers for later!</p>
<h2 id="create-projects">Create Projects</h2>
<p>To create the projects themselves, we&rsquo;re going to use a one-off Docker command to run a container.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Terminal</span>
</span></span><span style="display:flex;"><span>docker run --rm -it -v <span style="color:#e6db74">`</span>pwd<span style="color:#e6db74">`</span>/:/app node:18 bash
</span></span></code></pre></div>
  
  
<div class="box notices cstyle tip">
    <div class="box-label"><i class="fa-fw fas fa-lightbulb"></i> Tip</div>
    <div class="box-content">
<p>Make sure you run this command in the root directory of your project!</p>
    </div>
</div>
<p>In this command:</p>
<ul>
<li><code>docker run</code> will start a container to run a command. The container is removed when the command is finished.</li>
<li><code>--rm</code> will remove the container when it is finished</li>
<li><code>-it</code> will provide an interactive terminal</li>
<li><code>-v `pwd`/:/app&lt;/code&gt;</code> will create a volume mount between the current directory and the <code>/app</code> directory in the container.
<ul>
<li>Backticks around a command in the terminal will use the result of that command in the outer command. You could instead enter the full path to the current directory as part of the command, as in <code>-v /home/user/projects/fullstack:/app/code</code>.</li>
<li>See 

<a href="https://docs.docker.com/storage/volumes/" target="_blank" rel="noopener">Docker Volumes</a> for more details.</li>
</ul>
</li>
<li><code>node:18</code> is the name of the Docker image to run.
<ul>
<li>Refer to 

<a href="https://hub.docker.com/_/node/" target="_blank" rel="noopener">Node</a> on DockerHub for other image versions. At the time of writing, Node 18 is the current LTS version.</li>
</ul>
</li>
<li><code>bash</code> will load the Bash terminal inside of the container</li>
</ul>
<p>Refer to the 

<a href="https://docs.docker.com/engine/reference/commandline/run/" target="_blank" rel="noopener">Docker run</a> documentation for more details.</p>
<p>Once we have run that command, we should get a terminal inside of the container:</p>
<p><img src="../images/terminal.png" alt="Docker Terminal"></p>
<p>To create the projects, we are going to use 

<a href="https://expressjs.com/en/starter/generator.html" target="_blank" rel="noopener">Express Application Generator</a> and 

<a href="https://create-react-app.dev/" target="_blank" rel="noopener">Create React App</a>. You can refer to those pages for additional options that you can use when creating these projects.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Docker Container Terminal</span>
</span></span><span style="display:flex;"><span>npx express-generator -v ejs /app/server
</span></span><span style="display:flex;"><span>npx create-react-app /app/client
</span></span></code></pre></div><p>Next, we are going to set the owner and gorup of these files to match the effective user and group IDs of the host system outside of Docker. This allows us to maintain and modify the files in Visual Studio Code.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Docker Container Terminal</span>
</span></span><span style="display:flex;"><span>chown -R 1000:1000 /app/*
</span></span></code></pre></div>
  
  
<div class="box notices cstyle tip">
    <div class="box-label"><i class="fa-fw fas fa-lightbulb"></i> Tip</div>
    <div class="box-content">
<p>Modify the command above to match your IDs found earlier. The first one is the user Id and the second is the group ID.</p>
    </div>
</div>

  
  
<div class="box notices cstyle warning">
    <div class="box-label"><i class="fa-fw fas fa-exclamation-triangle"></i> Warning</div>
    <div class="box-content">
<p>Hopefully this highlights one of the major security concerns from using Docker volume mounts. The files are originally owned by the <code>root</code> user, but since Docker runs as <code>root</code> by default, we can use commands within a container to change file permissions that we may not be able to change outside of the container. In an enterprise setting, this means that anyone who can start Docker containers can in theory change these permissions.</p>
    </div>
</div>
<p>Once we are done, we can exit the container:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Docker Container Terminal</span>
</span></span><span style="display:flex;"><span>exit
</span></span></code></pre></div><p>This will stop the container and remove it.</p>
<h2 id="01">Remove Node Modules</h2>
<p>Finally, we want to remove the <code>node_modules</code> folders from both the <code>client</code> and <code>server</code> folders. These are created when the project is first initialized, but we don&rsquo;t want them outside of our actual containers. So, <strong>DELETE</strong> both <code>node_modules</code> folders!</p>
<h2 id="configure-docker">Configure Docker</h2>
<p>Now let&rsquo;s configure Docker to allow us to load both projects in separate Docker containers.</p>
<p>Create a <code>docker-compose.yml</code> file in the root directory of the project with the following content:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#75715e"># docker-compose.yml</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">services</span>:
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># server</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">project-server</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">build</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># location of Dockerfile</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">context</span>: <span style="color:#ae81ff">./server</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">project-server</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">networks</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">project-network</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># mount code into container</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./server:/app/server</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># maintain existing node_modules in container</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">/app/server/node_modules</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># client</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">project-client</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">build</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># location of Dockerfile</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">context</span>: <span style="color:#ae81ff">./client</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">project-client</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">depends_on</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># requires server to start</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">project-server</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">networks</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">project-network</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># allow external connections</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># mount code into container</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./client:/app/client</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># maintain existing node_modules in container</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">/app/client/node_modules</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">networks</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># internal Docker network for project</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">project-network</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">project-network</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">internal</span>: <span style="color:#66d9ef">true</span>
</span></span></code></pre></div><p>Refer to 

<a href="https://docs.docker.com/compose/compose-file/compose-file-v3/" target="_blank" rel="noopener">Docker Compose File Reference</a> for what this does.</p>
<p>We&rsquo;ll also need to add a Dockerfile to each project:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dockerfile" data-lang="dockerfile"><span style="display:flex;"><span><span style="color:#75715e"># client/Dockerfile</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># For running in development mode only</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> node:18</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> /app/client</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> package*.json ./<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> npm install<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">EXPOSE</span><span style="color:#e6db74"> 3000</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">CMD</span> [<span style="color:#e6db74">&#34;npm&#34;</span>, <span style="color:#e6db74">&#34;start&#34;</span>]<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dockerfile" data-lang="dockerfile"><span style="display:flex;"><span><span style="color:#75715e"># server/Dockerfile</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># For running in development mode only</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> node:18</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> /app/server</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> package*.json ./<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> npm install<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">EXPOSE</span><span style="color:#e6db74"> 3000</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">CMD</span> [<span style="color:#e6db74">&#34;npm&#34;</span>, <span style="color:#e6db74">&#34;start&#34;</span>]<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>Refer to 

<a href="https://docs.docker.com/engine/reference/builder/" target="_blank" rel="noopener">Dockerfile Reference</a> for the structure of these files.</p>
<p>Finally, we can start and run the Docker containers using Docker Compose:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Terminal</span>
</span></span><span style="display:flex;"><span>docker compose up -d
</span></span></code></pre></div><p>Refer to the 

<a href="https://docs.docker.com/compose/reference/" target="_blank" rel="noopener">Docker Compose CLI Reference</a> for how to use Docker Compose commands.</p>
<p>It will take a bit to build and configure both containers, but eventually the command should finish. This will be faster in the future. You can confirm they are running using the <code>docker ps</code> command.</p>
<p><img src="../images/docker_ps.png" alt="Docker PS"></p>
<p>To stop the containers when you are done, use</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Terminal</span>
</span></span><span style="display:flex;"><span>docker compose down
</span></span></code></pre></div><h2 id="commit">Commit</h2>
<p>This is a great place to stop and commit your work to GitHub.</p>

            <footer class="footline">
            </footer>
          </article>
        </div>
      </main>
    </div>
    
  </div>
    
    
    
    
    <script src="https://ksu-cs-textbooks.github.io/hugo-starter/js/clipboard.min.js?1689016652" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/hugo-starter/js/perfect-scrollbar.min.js?1689016652" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/hugo-starter/js/featherlight.min.js?1689016652" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/hugo-starter/js/theme.js?1689016652" defer></script>
    
    <script src="https://ksu-cs-textbooks.github.io/hugo-starter/js/tele-scroll.js?1689016652 defer"></script>
    
  </body>
</html>
